<section *ngIf="selectedChannel">
    <div class="row">
        <div class="col-md-2 p-0 nav-links">
            <app-nav-links></app-nav-links>
        </div>
        <div class="col-md-10 main mt-4">
            <div class="row">
                <div class="col-md-4 ">
                    <p class="d-inline username">{{selectedChannel.content}}</p>
                    <span class="d-inline cam"><i class="fa fa-video-camera" aria-hidden="true"></i></span>
                    <span class="d-inline mobile"><i class="fa fa-phone" aria-hidden="true"></i></span>
                </div>
                <div class="col-md-4">
                    <form>
                        <input type="search" class="mb-4" placeholder="search"><span class="ml-4 details">Details</span>
                    </form>
                </div>
                <div class="col-md-4 profile ">
                    <i class="fa fa-user-circle-o mr-4" aria-hidden="true" data-toggle="modal"
                        data-target="#myModal"></i>
                    <i class="fa fa-bell" aria-hidden="true"></i>
                </div>
            </div>
            <div class="row">
                <div class="col-md-8">
                    <div class="row" style="overflow-y: scroll; height:500px;" infiniteScroll
                        [infiniteScrollDistance]="1" [infiniteScrollThrottle]="50" (scrolled)="onChannelMessageScroll()"
                        [scrollWindow]="false">
                        <div class="col-12">
                            <div class="row" *ngFor="let msg of channelMessageList">
                                <div *ngIf="msg.messageType == 0" class="col-md-2">
                                    <img src="../../../../assets/images/team-1.png" alt="team-1">
                                </div>
                                <div *ngIf="msg.messageType == 0" class="col-md-10">
                                    <p>
                                        <b>{{msg.username}}</b> <br>
                                        <!-- <span class="message-link" *ngIf="msg.messageType == 1; else normalMessage"
                                            (click)="downloadFile($event,msg.dbFileName,msg.message)">
                                            {{msg.message}}
                                        </span> -->
                                        <!-- <ng-template #normalMessage> -->
                                        <span>
                                            {{msg.message}}
                                        </span>
                                        <!-- </ng-template> -->
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <form class="msg">
                        <input type="text" placeholder="message in #HR team" name="channelMessage"
                            [(ngModel)]="channelMessage" (keyup)="sendChannelMessage($event)">
                        <div class="icons">
                            <span class="attach"><i class="fa fa-paperclip" aria-hidden="true" data-toggle="modal"
                                    data-target="#fileUpload"></i></span>
                            <span class="smile"><i class="fa fa-smile-o" aria-hidden="true"></i></span>
                            <span class="video"><i class="fa fa-video-camera" aria-hidden="true"></i></span>
                            <span class="camera"><i class="fa fa-camera" aria-hidden="true"></i></span>
                        </div>
                    </form>
                </div>
                <div class="col-md-4">
                    <div class="users ">
                        <div class=" ml-2">
                            <span class="pl-3">
                                <h5 class="d-inline">Channel Members</h5>
                            </span>
                            <span class="ml-4">
                                <p class="d-inline" data-toggle="modal" data-target="#myModal1">+Add</p>
                            </span>
                        </div>
                        <div class="row">
                            <div class="col-md-2">
                                <img src="../../../../assets/images/team-1.png" alt="team-1">

                            </div>
                            <div class="col-md-8">
                                <p style="color:blue">you</p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-2">
                                <img src="../../../../assets/images/team-1.png" alt="team-1">

                            </div>
                            <div class="col-md-8">
                                <p style="color:blue">Aakash jain</p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-2">
                                <img src="../../../../assets/images/team-1.png" alt="team-1">

                            </div>
                            <div class="col-md-8">
                                <p style="color:blue">Riya Sen</p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-2">
                                <img src="../../../../assets/images/team-1.png" alt="team-1">

                            </div>
                            <div class="col-md-8">
                                <p style="color:blue">Praveen Roy</p>
                            </div>
                        </div>
                        <div class=" ml-2">
                            <span class="pl-3">
                                <h5 class="d-inline">Files Shared</h5>
                            </span>
                            <!-- <span class="ml-4">
                                <p class="d-inline" data-toggle="modal" data-target="#myModal2"><span
                                        style="margin-left: 61px;">+Add</span></p>
                            </span> -->
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <div class="row" style="overflow-y: scroll; height:200px;" infiniteScroll
                                    [infiniteScrollDistance]="1" [infiniteScrollThrottle]="50"
                                    (scrolled)="onChannelMessageScroll()" [scrollWindow]="false">
                                    <div class="col-12">
                                        <div class="row" *ngFor="let msg of channelFileMessageList">
                                            <div class="col-md-2">
                                                <img src="../../../../assets/images/team-1.png" alt="team-1">
                                            </div>
                                            <div class="col-md-8">
                                                <p><span style="color:blue">{{msg.message}}</span><br>{{msg.username}}
                                                    today at 20:00</p>
                                            </div>
                                            <div class="col-md-2">
                                                <span>
                                                    <i class="fa fa-download" aria-hidden="true" style="color:blue"
                                                        (click)="downloadFile($event,msg.dbFileName,msg.message)"></i>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- <div class="row">
                            <div class="col-md-2">
                                <img src="../../../../assets/images/team-1.png" alt="team-1">

                            </div>
                            <div class="col-md-8">
                                <p><span style="color:blue">design.mp4</span><br>Pranav today at 19:00</p>
                            </div>
                            <div class="col-md-2">
                                <span><i class="fa fa-download" aria-hidden="true" style="color:blue"></i></span>
                            </div>
                        </div> -->

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<div class="modal" id="myModal2">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div>
                <button type="button" class="close mt-4" data-dismiss="modal">&times;</button>
            </div>
            <figure>
                <img src="../../../../assets/images/pdf.png" alt="pdf">
                <figcaption class="text-center">video.mp4</figcaption>
            </figure>
            <form class="files">
                <span class="ml-4">Title</span>
                <div>
                    <input type="text" placeholder="Type here">
                </div>
                <span class="ml-4">Description</span>
                <div>
                    <input type="text" placeholder="Type here">
                </div>
                <span class="ml-4">share</span>
                <div class="share" style="width: 50%;">
                    <input type="text" placeholder="Type here">
                    <button type="button" class="upload">Upload</button>
                </div>

            </form>

            <div>
                <!-- <button type="button" class="button">Add</button> -->
            </div>


        </div>
    </div>
</div>

<div class="modal" id="myModal1">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div>
                <h4 class="modal-title ml-4">Add Members</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <form class="text">
                <h5 class="ml-3">Add</h5>

                <input type="text" placeholder="Steve@example.com,@Steve">
            </form>

            <div>
                <button type="button" class="button">Add</button>
            </div>


        </div>
    </div>
</div>

<!-- User List Modal -->
<div id="userList" class="modal fade bd-example-modal-lg" role="dialog">
    <div class="modal-dialog modal-lg">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">User List</h4>
                <button type="button" class="close" data-dismiss="modal" (click)="getUserList()">&times;</button>
            </div>
            <div class="modal-body" *ngIf="currentUserChannelData">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>Role</th>
                            <th *ngIf="currentUserChannelData.type == 'admin'">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr
                            *ngFor="let user of teamUserList | paginate: { itemsPerPage: 5, currentPage: p, id: 'teamUserList' }; let i = index ">
                            <td>{{i+1}}</td>
                            <td>{{user.username}}</td>
                            <td>{{user.type}}</td>
                            <td
                                *ngIf="currentUserChannelData.type == 'admin' && user.uId != currentUserChannelData.uId">
                                <div>
                                    <!-- <a href="#" class="settings" title="Settings" data-toggle="tooltip"><i
                                            class="material-icons">&#xE8B8;</i></a> -->
                                    <button *ngIf="user.type != 'admin'" class="btn btn-danger"
                                        (click)="changeUserType(user.uId, 'admin')">Assign As
                                        Admin</button> &nbsp;
                                    <button *ngIf="user.type == 'admin'" class="btn btn-danger"
                                        (click)="changeUserType(user.uId, 'normal')">Remove As
                                        Admin</button> &nbsp;
                                    <button class="btn btn-danger"
                                        (click)="deleteUserIntoTeamChannel(user.uId)">Delete</button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="clearfix">
                    <pagination-controls (pageChange)="p = $event" id="teamUserList"></pagination-controls>
                </div>

                <div *ngIf="currentUserChannelData.type == 'admin'">
                    <h4 class="modal-title mt-1">Add User Into List</h4>
                    <div class="row">
                        <div class="col-12">
                            <input type="text" placeholder="Search User" name="searchRegisterUser"
                                [(ngModel)]="searchTeamListAddUser" (keyup)="filterTeamUserList()" />
                        </div>
                    </div>
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr
                                *ngFor="let user of registerUserList | paginate: { itemsPerPage: 5, currentPage: regUserPage, id: 'registerUserList' }; let i = index ">
                                <td>{{i+1}}</td>
                                <td>{{user.username}}</td>
                                <td>{{user.email}}</td>
                                <td>
                                    <div *ngIf='permissionType; else notallow'>
                                        <button *ngIf="!user.isRequest" class="btn btn-primary"
                                            (click)="sendRequest(user.id, user.email)">Send Request</button>
                                        <button *ngIf="user.isRequest == 1" class="btn btn-primary"
                                            (click)="sendRequest(user.id, user.email)">Send Request Again</button>
                                    </div>
                                    <ng-template #notallow>
                                        <button class="btn btn-primary" (click)="addUserIntoTeamChannel(user.id)">Add
                                            User</button>
                                    </ng-template>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="clearfix">
                        <pagination-controls (pageChange)="regUserPage = $event" id="registerUserList">
                        </pagination-controls>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>


<!-- File upload Modal -->
<div id="fileUpload" class="modal fade bd-example-modal-lg" role="dialog">
    <div class="modal-dialog modal-lg">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">File Upload</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <form name="sendFileForm" #fileForm="ngForm" (ngSubmit)="fileForm.valid && onUpload()"
                enctype="multipart/form-data" novalidate>
                <div class="modal-body">
                    <!-- <input type="file" name="fileupload" [(ngModel)]="selectedFile" #fileUpload="ngModel"
                        (change)="onFileSelected($event)" required />
                    <div *ngIf="fileForm.submitted && fileUpload.invalid && fileUpload.errors"
                        class="w-100 alert alert-danger mt-1">
                        Please select file.
                    </div> -->
                    <!-- <dropzone [config]="config" [message]="'Click or drag images here to upload'" (error)="onUploadError($event)" (success)="onUploadSuccess($event)"></dropzone> -->
                    <div class="vertical-container" fxLayout="column" fxLayoutAlign="stretch" fxFlex="50%">
                        <div class="content-container" fxLayout="column" fxLayoutAlign="stretch" fxFlex="auto">
                            <dropzone class="dropzone-container" [config]="config" [disabled]="disabled" fxLayout="row"
                                fxLayoutAlign="start strech" fxFlex="auto"
                                [message]="'Click or drag file here to upload'" (init)="onUploadInit($event)"
                                (error)="onUploadError($event)" (success)="onUploadSuccess($event)"></dropzone>
                        </div>
                        <div *ngIf="fileUpload" class="w-100 alert alert-danger mt-1">
                            Please select file.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Upload</button>
                    <button type="button" (click)="resetDropzoneUploads()" class="btn btn-primary">Reset Upload</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </form>
        </div>

    </div>
</div>


<!-- Users List Modal -->
<div id="usersList" class="modal fade bd-example-modal-lg" role="dialog">
    <div class="modal-dialog modal-lg">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Users Status</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Status</th>
                            <th>Name</th>
                            <th>Role</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr
                            *ngFor="let user of teamUserStatus | paginate: { itemsPerPage: 5, currentPage: p, id: 'teamUserStatus' }; let i = index ">
                            <td>{{i+1}}</td>
                            <td><span class="dot" [style.background-color]="user.status_color"></span>
                                &nbsp;{{user.status}}</td>
                            <td>{{user.username}}</td>
                            <td>{{user.email}}</td>
                        </tr>
                    </tbody>
                </table>
                <div class="clearfix">
                    <pagination-controls (pageChange)="p = $event" id="teamUserStatus"></pagination-controls>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>


<!-- Channel update Modal -->
<div id="contentUpd" class="modal fade bd-example-modal-lg" role="dialog">
    <div class="modal-dialog modal-lg">

        <!-- Modal content-->
        <div class="modal-content" *ngIf="selectedChannel">
            <div class="modal-header">
                <h4 class="modal-title">Channel Update</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <form name="sendFileForm" #contentForm="ngForm" (ngSubmit)="contentForm.valid && channelUpd(contentForm)"
                novalidate>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="content">Content</label>
                        <input type="text" class="form-control" name="content" #content="ngModel"
                            placeholder="# e.g.subscription-budget" (change)="checkValidContentName(contentForm)"
                            [ngClass]="{ 'is-invalid': contentForm.submitted && content.invalid, 'is-valid' :  contentForm.submitted && content.valid}"
                            [(ngModel)]="selectedChannel.content" required />
                        <div *ngIf="contentForm.submitted && content.errors" class="mt-1">
                            <small *ngIf="content.invalid && content.errors.required" class="text-danger">
                                Channel content is required
                            </small>
                            <small *ngIf="content.errors.pattern" class="text-danger"># is required</small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea class="form-control" name="description" #description="ngModel"
                            [(ngModel)]="selectedChannel.description"
                            [ngClass]="{ 'is-invalid': contentForm.submitted && description.invalid, 'is-valid' :  contentForm.submitted && description.valid}"
                            required></textarea>
                        <div *ngIf="contentForm.submitted && description.errors" class="mt-1">
                            <small *ngIf="description.invalid && description.errors.required" class="text-danger">
                                Channel description is required
                            </small>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Update</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </form>
        </div>

    </div>
</div>

<!-- Invite Guest User Modal -->
<div id="inviteGuestUser" class="modal fade bd-example-modal-lg" role="dialog">
    <div class="modal-dialog modal-lg">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Invite Guest User</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <form name="guestUserForm" #guestUserForm="ngForm"
                (ngSubmit)="guestUserForm.valid && sendGuestRequestUser(guestUserForm)" novalidate>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="content">Email</label>
                        <input type="email" class="form-control" name="email" #guestEmail="ngModel"
                            placeholder="Email address" (blur)="checkValidEmail(guestUserForm)"
                            [ngClass]="{ 'is-invalid': guestUserForm.submitted && guestEmail.invalid, 'is-valid' :  guestUserForm.submitted && guestEmail.valid}"
                            [(ngModel)]="guestInviteEmail" required />
                        <div *ngIf="guestUserForm.submitted && guestEmail.errors" class="mt-1">
                            <small *ngIf="guestEmail.invalid && guestEmail.errors.required" class="text-danger">
                                Email address is required.
                            </small>
                            <small *ngIf="guestEmail.errors.isEmailInvalid" class="text-danger">Please enter valid
                                email.</small>
                            <small *ngIf="guestEmail.errors.isEmailAlreadyReg" class="text-danger">Email address is
                                already used.</small>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Send Request</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </form>
        </div>

    </div>
</div>